<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>å¼ _0342_job5</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .box { border:1px solid #ddd; padding:15px; margin:15px 0; border-radius:5px; }
    .clock { font-size: 20px; font-weight: bold; color: #336699; margin:10px 0; }
    label { display:inline-block; width:120px; margin-bottom:8px; }
    input, select { padding:6px; width:200px; margin-bottom:10px; }
    table { border-collapse: collapse; width:100%; margin-top:10px; }
    th, td { border:1px solid #ccc; padding:8px; text-align:center; }
    th { background-color: #f2f2f2; }
    button { padding:8px 16px; background-color: #4CAF50; color:white; border:none; cursor:pointer; }
    button:hover { background-color: #45a049; }
    .discount-info { background:#eef9ff; border-left:5px solid #3aa0e6; padding:12px; margin:15px 0; }
    .time-alert { background:#fffbe6; border-left:5px solid #f4d06f; padding:12px; margin:15px 0; }
    .tip { background:#f5f5f5; border-left:5px solid #ccc; padding:12px; margin:15px 0; }
  </style>
</head>
<body>

<!-- ===================== é¡¶éƒ¨æ ‡é¢˜ ===================== -->
<script>
  /**
   * document.write()
   * åŠŸèƒ½ï¼šå‘ HTML é¡µé¢"ç›´æ¥å†™å…¥"å†…å®¹ï¼Œç›¸å½“äºæ’å…¥ HTML ä»£ç ã€‚
   * ç‰¹ç‚¹ï¼šåœ¨é¡µé¢åŠ è½½æ—¶æ‰§è¡Œï¼Œé€‚åˆè¾“å‡ºæ ‡é¢˜ã€æç¤ºåŒºåŸŸã€‚
   */
  document.write("<h1>XXç”µå•† Â· è¿è¥åå° Â· è®¢å•å½•å…¥ä¸é”€å”®çœ‹æ¿</h1>");
  document.write("<p>æ¬¢è¿ä½¿ç”¨å†…éƒ¨å·¥å…·ï¼Œå®æ—¶æŸ¥çœ‹è®¢å•ä¸é”€å”®æƒ…å†µã€‚</p>");

  // ===================== å…¨å±€ä¼˜æƒ  + åŠ ä»·æ¸©é¦¨æç¤º =====================
  document.write(`
  <div class="discount-info">
    <strong>ğŸ’¡ æ¸©é¦¨æç¤ºï¼šæœ¬åº—å½“å‰å¯äº«å—çš„ä¼˜æƒ ä¸åŠ ä»·æ”¿ç­–å¦‚ä¸‹ï¼š</strong>
    <ul style="margin:8px 0 0 20px; line-height:1.6;">
      <li>ğŸ‰ VIP å®¢æˆ·äº«å— <strong>9 æŠ˜ä¼˜æƒ </strong></li>
      <li>ğŸ æ™®é€šå®¢æˆ·è´­ä¹°è¶…è¿‡ 3 ä»¶äº«å— <strong>é¢å¤– 9 æŠ˜ä¼˜æƒ </strong></li>
      <li>âš¡ åŠ æ€¥å‘è´§ä»·æ ¼ä¼š <strong>Ã—1.1</strong></li>
      <li>â° æ¯å°æ—¶å‰ 10 åˆ†é’Ÿå†äº« <strong>8.5 æŠ˜</strong></li>
    </ul>
  </div>
  `);

  // ===================== å½“å‰åˆ†é’ŸåŠ¨æ€æ´»åŠ¨æç¤º =====================
  var nowForBanner = new Date();            // Date()ï¼šåˆ›å»ºä¸€ä¸ªæ—¶é—´å¯¹è±¡
  var minuteForBanner = nowForBanner.getMinutes(); // getMinutes()ï¼šè·å–å½“å‰åˆ†é’Ÿï¼ˆ0â€“59ï¼‰

  if (minuteForBanner >= 0 && minuteForBanner <= 9) {
    document.write(`
      <div class="time-alert">
        â³ å½“å‰ä¸ºå‰ 10 åˆ†é’Ÿï¼æœ¬å•å¯é¢å¤–äº«å— <strong>8.5 æŠ˜</strong> æ—¶æ®µä¼˜æƒ ï¼
      </div>
    `);
  } else {
    document.write(`
      <div class="tip">
        ğŸ•’ å°è´´å£«ï¼šæ¯ä¸ªæ•´ç‚¹å‰ 10 åˆ†é’Ÿäº«å— 8.5 æŠ˜ä¼˜æƒ ï¼Œè¯·ç•™æ„ä¸‹å•æ—¶é—´ï½
      </div>
    `);
  }
</script>

<!-- ===================== æ—¶é’ŸåŒº ===================== -->
<div class="box">
  <h2>å½“å‰ç³»ç»Ÿæ—¶é—´</h2>
  <!-- æ­¤åŒºåŸŸçš„æ–‡å­—ç”± JavaScript åŠ¨æ€æ›´æ–° -->
  <div id="clock" class="clock"></div>
</div>

<!-- ===================== è®¢å•å½•å…¥ ===================== -->
<div class="box">
  <h2>æ–°å»ºè®¢å•</h2>

  <!-- onsubmit="return validateForm()"ï¼šæäº¤è¡¨å•å‰è°ƒç”¨ JS åšæ ¡éªŒ -->
  <form onsubmit="return validateForm();">
    <p>
      <label>å®¢æˆ·åç§°ï¼š</label>
      <input type="text" id="customerName">
    </p>
    <p>
      <label>å•†å“å•ä»·ï¼ˆÂ¥ï¼‰ï¼š</label>
      <input type="text" id="priceInput">
    </p>
    <p>
      <label>æ•°é‡ï¼ˆä»¶ï¼‰ï¼š</label>
      <input type="text" id="qtyInput">
    </p>
    <p>
      <label>å®¢æˆ·ç±»å‹ï¼š</label>
      <select id="customerType">
        <option value="normal">æ™®é€šå®¢æˆ·</option>
        <option value="vip">VIP å®¢æˆ·</option>
      </select>
    </p>
    <p>
      <label>åŠ æ€¥å‘è´§ï¼š</label>
      <input type="checkbox" id="urgentFlag"> æ˜¯
    </p>
    <p><button type="submit">æ·»åŠ è®¢å•</button></p>
  </form>

  <div id="orderResult"></div>
</div>

<!-- ===================== é”€å”®çœ‹æ¿ ===================== -->
<div class="box">
  <h2>é”€å”®çœ‹æ¿</h2>
  <div id="dashboard"></div>
  <div id="orderTable"></div>
</div>

<script>
  // ================================================================
  //                          æ¨¡æ‹Ÿæ—¶é’ŸåŠŸèƒ½
  // ================================================================

  /**
   * padZero(n)
   * åŠŸèƒ½ï¼šå°†æ•°å­—è¡¥é›¶ï¼Œä¾‹å¦‚ 7 â†’ "07"
   * ç”¨é€”ï¼šè®©æ—¥æœŸæ—¶é—´ä¿æŒä¸¤ä½å±•ç¤ºæ ¼å¼
   */
  function padZero(n) {
    return n < 10 ? "0" + n : n;
  }

  /**
   * updateClock()
   * åŠŸèƒ½ï¼šè·å–å½“å‰æ—¶é—´ â†’ æ ¼å¼åŒ– â†’ å†™å…¥é¡µé¢
   * æŠ€æœ¯ç‚¹ï¼š
   *   - Date()                  è·å–å½“å‰æ—¶é—´
   *   - getElementById()        è·å–é¡µé¢æŒ‡å®š id çš„å…ƒç´ 
   *   - innerHTML               ç”¨äºè®¾ç½®å…ƒç´ çš„ HTML å†…å®¹
   */
  function updateClock() {
    var now = new Date();
    var y = now.getFullYear();
    var m = now.getMonth() + 1;
    var d = now.getDate();
    var hh = now.getHours();
    var mm = now.getMinutes();
    var ss = now.getSeconds();

    var weekNames = ["æ—¥", "ä¸€", "äºŒ", "ä¸‰", "å››", "äº”", "å…­"];
    var w = weekNames[now.getDay()];

    var timeStr =
      y + "å¹´" + padZero(m) + "æœˆ" + padZero(d) +
      "æ—¥ æ˜ŸæœŸ" + w + " " +
      padZero(hh) + ":" + padZero(mm) + ":" + padZero(ss);

    // document.getElementById("clock")
    // åŠŸèƒ½ï¼šè¿”å›é¡µé¢ä¸­ id="clock" çš„é‚£ä¸ªå…ƒç´ 
    document.getElementById("clock").innerHTML = timeStr;
  }

  updateClock();               // é¡µé¢åˆšåŠ è½½æ—¶è°ƒç”¨ä¸€æ¬¡
  setInterval(updateClock, 1000); // setIntervalï¼šæ¯ 1000ms è°ƒç”¨ä¸€æ¬¡ â†’ å®ç°èµ°åŠ¨çš„æ—¶é’Ÿ


  // ================================================================
  //                         å…¨å±€è®¢å•æ•°ç»„
  // ================================================================
  /**
   * orders æ•°ç»„ï¼Œä¿å­˜æ‰€æœ‰è®¢å•è®°å½•
   * æ¯ä¸€ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªè®¢å•å¯¹è±¡ {name, qty, price, finalTotal ... }
   */
  var orders = [];


  // ================================================================
  //                         è¡¨å•æ ¡éªŒé€»è¾‘
  // ================================================================
  function validateForm() {
    /**
     * document.getElementById("xxx").value
     * è¯´æ˜ï¼šä»é¡µé¢ä¸­è·å– id="xxx" çš„è¾“å…¥æ¡†å†…å®¹
     */
    var nameStr = document.getElementById("customerName").value;
    var priceStr = document.getElementById("priceInput").value;
    var qtyStr = document.getElementById("qtyInput").value;
    var typeStr = document.getElementById("customerType").value;
    var urgentChecked = document.getElementById("urgentFlag").checked;

    var valid = true;

    // å®¢æˆ·åç§°æ ¡éªŒ
    if (nameStr == null || nameStr.trim() === "") {
      alert("å®¢æˆ·åç§°ä¸èƒ½ä¸ºç©ºï¼");
      valid = false;
    }

    // parseFloat()ï¼šæŠŠå­—ç¬¦ä¸²è½¬æˆæµ®ç‚¹å‹æ•°å­—
    var price = parseFloat(priceStr);
    if (isNaN(price) || price <= 0) {
      alert("å•†å“å•ä»·å¿…é¡»æ˜¯å¤§äº 0 çš„æ•°å­—ï¼");
      valid = false;
    }

    // parseInt()ï¼šæŠŠå­—ç¬¦ä¸²è½¬æˆæ•´æ•°
    var qty = parseInt(qtyStr, 10);
    if (isNaN(qty) || qty <= 0) {
      alert("æ•°é‡å¿…é¡»æ˜¯å¤§äº 0 çš„æ•´æ•°ï¼");
      valid = false;
    }

    if (!valid) {
      document.getElementById("orderResult").innerHTML =
        "<p>è®¢å•å½•å…¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥è¾“å…¥ã€‚</p>";
      return false;
    }

    processOrder(nameStr.trim(), price, qty, typeStr === "vip", urgentChecked);
    return false;
  }


  // ================================================================
  //                         è®¢å•ä¸šåŠ¡é€»è¾‘ï¼ˆåŒ…å«æ‚¨çš„5ä¸ªéœ€æ±‚ï¼‰
  // ================================================================
  function processOrder(customerName, price, quantity, isVip, isUrgent) {
    // â‘  æ­£å¸¸æ€»ä»· = å•ä»· Ã— æ•°é‡
    var baseTotal = price * quantity;
    
    // â‘¡ VIPæŠ˜æ‰£
    var afterVip = isVip ? baseTotal * 0.9 : baseTotal;
    
    // â‘¢ åŠ æ€¥è´¹ç”¨
    var afterUrgent = isUrgent ? afterVip * 1.1 : afterVip;
    
    // â‘£ æ—¶é—´æŠ˜æ‰£ï¼ˆæ¯å°æ—¶å‰10åˆ†é’Ÿï¼‰
    var now = new Date();
    var minute = now.getMinutes();
    var hitTimeDiscount = false;
    var afterTimeDiscount = afterUrgent;
    
    if (minute >= 0 && minute <= 9) {
      afterTimeDiscount = afterUrgent * 0.85;
      hitTimeDiscount = true;
    }
    
    // â‘¤ æ–°å¢è§„åˆ™ï¼šæ™®é€šå®¢æˆ·è´­ä¹°è¶…è¿‡3ä»¶å†æ‰“9æŠ˜
    var finalTotal = afterTimeDiscount;
    var extraDiscount = false;
    
    if (!isVip && quantity > 3) {
      finalTotal = finalTotal * 0.9;
      extraDiscount = true;
    }
    
    // æ˜¾ç¤ºè®¢å•å¤„ç†ç»“æœ
    var resultHTML = "<h3>è®¢å•å½•å…¥æˆåŠŸï¼š</h3>";
    resultHTML += "<p>å®¢æˆ·åç§°ï¼š" + customerName + "</p>";
    resultHTML += "<p>å•†å“å•ä»·ï¼šÂ¥" + price.toFixed(2) + "</p>";
    resultHTML += "<p>è´­ä¹°æ•°é‡ï¼š" + quantity + "ä»¶</p>";
    resultHTML += "<p>å®¢æˆ·ç±»å‹ï¼š" + (isVip ? "VIPå®¢æˆ·" : "æ™®é€šå®¢æˆ·") + "</p>";
    resultHTML += "<p>æ˜¯å¦åŠ æ€¥ï¼š" + (isUrgent ? "æ˜¯" : "å¦") + "</p><hr>";
    
    resultHTML += "<p><strong>ä»·æ ¼è®¡ç®—æ˜ç»†ï¼š</strong></p>";
    resultHTML += "<p>â‘  åŸºç¡€é‡‘é¢ (å•ä»·Ã—æ•°é‡)ï¼šÂ¥" + baseTotal.toFixed(2) + "</p>";
    
    if (isVip) {
      resultHTML += "<p>â‘¡ VIP 9æŠ˜ä¼˜æƒ åï¼šÂ¥" + afterVip.toFixed(2) + "</p>";
    } else {
      resultHTML += "<p>â‘¡ æ— VIPæŠ˜æ‰£ï¼šÂ¥" + afterVip.toFixed(2) + "</p>";
    }
    
    if (isUrgent) {
      resultHTML += "<p>â‘¢ åŠ æ€¥è´¹ç”¨ (+10%)ï¼šÂ¥" + afterUrgent.toFixed(2) + "</p>";
    } else {
      resultHTML += "<p>â‘¢ æ— åŠ æ€¥è´¹ç”¨ï¼šÂ¥" + afterUrgent.toFixed(2) + "</p>";
    }
    
    if (hitTimeDiscount) {
      resultHTML += "<p>â‘£ æ—¶æ®µæŠ˜æ‰£ (8.5æŠ˜)ï¼šÂ¥" + afterTimeDiscount.toFixed(2) + "</p>";
    } else {
      resultHTML += "<p>â‘£ æ— æ—¶æ®µæŠ˜æ‰£ï¼šÂ¥" + afterTimeDiscount.toFixed(2) + "</p>";
    }
    
    if (extraDiscount) {
      resultHTML += "<p>â‘¤ æ™®é€šå®¢æˆ·æ•°é‡>3ä»¶é¢å¤–9æŠ˜ï¼šÂ¥" + finalTotal.toFixed(2) + "</p>";
    }
    
    resultHTML += "<p style='font-size:18px; color:red;'><strong>æœ€ç»ˆé‡‘é¢ï¼šÂ¥" + finalTotal.toFixed(2) + "</strong></p>";
    
    document.getElementById("orderResult").innerHTML = resultHTML;
    
    // ä¿å­˜è®¢å•åˆ°æ•°ç»„
    orders.push({
      name: customerName,
      price: price,
      qty: quantity,
      baseTotal: baseTotal,
      afterVip: afterVip,
      afterUrgent: afterUrgent,
      finalTotal: finalTotal,
      isVip: isVip,
      isUrgent: isUrgent,
      hitTimeDiscount: hitTimeDiscount,
      extraDiscount: extraDiscount
    });
    
    renderDashboard();
  }


  // ================================================================
  //                         é”€å”®çœ‹æ¿
  // ================================================================
  function renderDashboard() {
    var count = orders.length;
    var totalSales = 0;

    // for å¾ªç¯ç´¯åŠ è®¢å•é‡‘é¢ï¼ˆçŸ¥è¯†ç‚¹ï¼šå¾ªç¯è¯­å¥ï¼‰
    for (var i = 0; i < orders.length; i++) {
      totalSales += orders[i].finalTotal;
    }

    var avg = count > 0 ? totalSales / count : 0;

    /**
     * innerHTML:
     * åŠŸèƒ½ï¼šä¿®æ”¹ä¸€ä¸ªå…ƒç´ å†…éƒ¨æ˜¾ç¤ºçš„ HTML å†…å®¹
     * ç”¨æ³•ï¼šdocument.getElementById(xxx).innerHTML = "å†…å®¹";
     */
    document.getElementById("dashboard").innerHTML =
      "<p><strong>è®¢å•æ•°ï¼š</strong>" + count + "</p>" +
      "<p><strong>é”€å”®æ€»é¢ï¼š</strong>Â¥" + totalSales.toFixed(2) + "</p>" +
      "<p><strong>å¹³å‡å®¢å•ä»·ï¼š</strong>Â¥" + avg.toFixed(2) + "</p>";

    if (count === 0) {
      document.getElementById("orderTable").innerHTML = "<p>æš‚æ— è®¢å•æ•°æ®</p>";
      return;
    }

    var tableHtml = "<table><tr>" +
      "<th>å®¢æˆ·åç§°</th><th>å•ä»·</th><th>æ•°é‡</th><th>åŸºç¡€é‡‘é¢</th><th>æœ€ç»ˆé‡‘é¢</th><th>VIP</th><th>åŠ æ€¥</th><th>æ—¶æ®µæŠ˜æ‰£</th><th>é¢å¤–æŠ˜æ‰£</th></tr>";

    for (var j = 0; j < orders.length; j++) {
      var o = orders[j];
      tableHtml += "<tr>" +
        "<td>" + o.name + "</td>" +
        "<td>Â¥" + o.price.toFixed(2) + "</td>" +
        "<td>" + o.qty + "</td>" +
        "<td>Â¥" + o.baseTotal.toFixed(2) + "</td>" +
        "<td><strong>Â¥" + o.finalTotal.toFixed(2) + "</strong></td>" +
        "<td>" + (o.isVip ? "æ˜¯" : "å¦") + "</td>" +
        "<td>" + (o.isUrgent ? "æ˜¯" : "å¦") + "</td>" +
        "<td>" + (o.hitTimeDiscount ? "æ˜¯" : "å¦") + "</td>" +
        "<td>" + (o.extraDiscount ? "æ˜¯" : "å¦") + "</td>" +
        "</tr>";
    }

    tableHtml += "</table>";
    document.getElementById("orderTable").innerHTML = tableHtml;
  }
  
  // åˆå§‹åŒ–é”€å”®çœ‹æ¿
  renderDashboard();
</script>

</body>

</html>
